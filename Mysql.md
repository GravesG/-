> Mysql 层次

- Server层
  - 连接器：管理链接，权限验证
  - 查询缓存：命中则直接返回结果
  - 分析器：次发分析，语法分析
  - 优化器：执行计划生成，索引选择
  - 执行器：操作索引，返回结果
- 存储引擎层
  - 存储
  - 提取



> 两个重要的日志模块

- redo log(重做日志)
  - WAL（Write-Ahead Logging）: 关键的先写日志再写磁盘
  - 固定大小：比如可以配置为一组4个文件，每个文件是1GB,那么就可以记录4G
  - ![image-20200622164739658](C:\Users\guozetao\AppData\Roaming\Typora\typora-user-images\image-20200622164739658.png)
  - write pos 是当前记录的位置，checkpoint是当前要擦除的位置，也是往后推移并且循环的
  - crash-save：有了redo log, InnoDB就可以保障及时数据库发生了异常重启，之前提交的记录都不会丢失。
  - 属于引擎层
- binlog（归档日志）
  - 以追加的形式写入



> 更新的流程

![image-20200622172728101](C:\Users\guozetao\AppData\Roaming\Typora\typora-user-images\image-20200622172728101.png)



> 什么是两阶段提交

为了让两份日志之间的逻辑一致。



 ==innodb_flush_log_at_trx_commit 这个参数设置成 1 的时候，==
==表示每次事务的 redo log 都直接持久化到磁盘==

==sync_binlog 这个参数设置成 1 的时候，表示每次事务的 binlog 都持久化到磁盘。这个参数我也建议你设置成 1 ，这样可以保证 MySQL 异常重启之后 binlog 不丢失==



> 隔离性与隔离级别

 ACID （ Atomicity 、 Consistency 、 Isolation 、 Durability ，即原子性、一致性、隔离性、持久性）

 SQL 标准的事务隔离级别包括：

- 读未提交是指，一个事务还没提交时，它做的变更就能被别的事务看到。
- 读提交是指，一个事务提交之后，它做的变更才会被其他事务看到。
- 可重复读是指，一个事务执行过程中看到的数据，总是跟这个事务在启动时看到的数据是一致的。当然在可重复读隔离级别下，未提交变更对其他事务也是不可见的。
- 串行化，顾名思义是对于同一行记录， “ 写 ” 会加 “ 写锁 ” ， “ 读 ” 会加 “ 读锁 ” 。当出现读写锁冲突的时候，后访问的事务必须等前一个事务执行完成，才能继续执行。